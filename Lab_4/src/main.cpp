//***************************************************************************************************************
// Universidad del Valle de Guatemala 
// BE3015 - Electrónica Digital 2
// Jeremy Mejía 
// Laboratorio #4
// Arduino
// Carné: 19846
//***************************************************************************************************************

//***************************************************************************************************************
// Librerías
//***************************************************************************************************************

#include <Arduino.h>
#include <LiquidCrystal.h>

//***************************************************************************************************************
// Definición de Pines
//***************************************************************************************************************

//Definición de entradas
#define BtnIn 13 //Botón Incrementar
#define BtnDe 12 //Botón Decrementar
#define Pot1 14 //Potenciómetro 1
#define Pot2 27 //Potenciómetro 2

//Definición de pines de salidas LCD
#define RS 2
#define E 16
#define D4 21
#define D5 3
#define D6 1
#define D7 22



//***************************************************************************************************************
// Prototipo de Funciones
//***************************************************************************************************************
void LCD1 (void);
void Antirrebote(void);

//***************************************************************************************************************
// Variabeles globales 
//***************************************************************************************************************
int contador = 0;
LiquidCrystal LCD(RS, E, D4, D5, D6, D7);
uint8_t decenas, unidades, decimal; 
int adcRaw;
float voltaje; 
//***************************************************************************************************************
// ISR (Interrupciones)
//***************************************************************************************************************
void IRAM_ATTR BtnIncrementar(){
  contador = 1;
}

//***************************************************************************************************************
// Configuración
//***************************************************************************************************************


void setup() {
  Serial.begin(115200);
  LCD.begin(16, 2);
}


//***************************************************************************************************************
// Loop Principal
//***************************************************************************************************************

void loop() {
  voltaje = analogReadMilliVolts(Pot1) / 10.0;
  int temp = voltaje;
  decenas = temp / 100.0;
  temp = temp - decenas *100.0;
  unidades = temp / 10.0; 
  temp = temp - unidades *10.0;
  decimal = temp; 

  LCD.clear();
  LCD.print("Voltaje");
  LCD.setCursor(2, 1);
  LCD.print(decenas);
  LCD.print(".");
  LCD.print(unidades);
  LCD.print(decimal);
  delay(250);
}
//***************************************************************************************************************
// Función Antirrebote
//***************************************************************************************************************

void Antirrebote(){
  if (contador == 1 && BtnIn == 0){
    delay(150);
    contador = 0; 
  }

  if (contador == 1 && BtnDe == 0){
    delay(150);
    contador = 0; 
  }

}
